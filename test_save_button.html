<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¿å­˜ãƒœã‚¿ãƒ³æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: 'Yu Gothic', sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 8px;
        }
        .test-button {
            padding: 10px 20px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #45a049;
        }
        .result {
            margin-top: 20px;
            padding: 10px;
            background: white;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        .success {
            color: #4CAF50;
        }
        .error {
            color: #f44336;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª å±…å®…ç™‚é¤Šç®¡ç†æŒ‡å°å ±å‘Šæ›¸ ä¿å­˜æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h1>

    <div class="test-section">
        <h2>ğŸ“‹ å®Ÿè£…å†…å®¹ã®ç¢ºèª</h2>
        <ul>
            <li>âœ… ä¿å­˜ãƒœã‚¿ãƒ³ã®è¡¨ç¤ºï¼ˆç·¨é›†ãƒ¢ãƒ¼ãƒ‰æ™‚ï¼‰</li>
            <li>âœ… ãƒ‡ãƒ¼ã‚¿åé›†é–¢æ•°ï¼ˆcollectReportDataï¼‰</li>
            <li>âœ… APIå‘¼ã³å‡ºã—ï¼ˆ/api/ai/save-kyotaku-reportï¼‰</li>
            <li>âœ… UIãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼ˆä¿å­˜ä¸­ãƒ»æˆåŠŸãƒ»ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºï¼‰</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>ğŸ¯ ãƒ†ã‚¹ãƒˆæ‰‹é †</h2>
        <ol>
            <li>AIå ±å‘Šæ›¸ä½œæˆãƒšãƒ¼ã‚¸ï¼ˆ<a href="/ai_report.html" target="_blank">/ai_report.html</a>ï¼‰ã‚’é–‹ã</li>
            <li>æ‚£è€…ã‚’é¸æŠã—ã¦ã€Œæ¬¡ã¸ã€ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
            <li>ã‚«ãƒ«ãƒ†å†…å®¹ã‚’å…¥åŠ›ã—ã¦ã€Œã“ã®å†…å®¹ã§ãƒ¬ãƒãƒ¼ãƒˆã‚’AIç”Ÿæˆã™ã‚‹ã€ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
            <li>ç”Ÿæˆå®Œäº†å¾Œã€å ±å‘Šæ›¸ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒæ–°ã—ã„ã‚¿ãƒ–ã§é–‹ã</li>
            <li>ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»é¢ã§ã€Œç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
            <li><strong>ã€Œã“ã®å†…å®¹ã§ä¿å­˜ã€ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª</strong></li>
            <li>ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦PDFä¿å­˜å‡¦ç†ã‚’å®Ÿè¡Œ</li>
        </ol>
    </div>

    <div class="test-section">
        <h2>ğŸ” APIç›´æ¥ãƒ†ã‚¹ãƒˆ</h2>
        <button class="test-button" onclick="testAPI()">APIãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
        <div id="apiResult" class="result" style="display:none;"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ“‚ ãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª</h2>
        <p>ä¿å­˜ã•ã‚ŒãŸPDFãƒ•ã‚¡ã‚¤ãƒ«ã¯ä»¥ä¸‹ã®ãƒ‘ã‚¹ã«æ ¼ç´ã•ã‚Œã¾ã™ï¼š</p>
        <code>C:\Users\hyosh\Desktop\allright\ageagekun\patients\[æ‚£è€…ID]\[æ—¥ä»˜]å±…å®…ç™‚é¤Šç®¡ç†æŒ‡å°å ±å‘Šæ›¸.pdf</code>
    </div>

    <script>
        async function testAPI() {
            const resultDiv = document.getElementById('apiResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = 'ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...';

            const testData = {
                reportData: {
                    patientId: '99999997',
                    patientName: 'ãƒ†ã‚¹ãƒˆèŠ±å­',
                    address: 'æ±äº¬éƒ½æ–°å®¿åŒº1-1-1',
                    content: 'ãƒ†ã‚¹ãƒˆç”¨ã®å ±å‘Šå†…å®¹ã§ã™ã€‚',
                    observations: 'ç‰¹è¨˜äº‹é …ãªã—',
                    author: 'ãƒ†ã‚¹ãƒˆåŒ»å¸«',
                    facility: 'ãƒ†ã‚¹ãƒˆã‚¯ãƒªãƒ‹ãƒƒã‚¯'
                },
                patientId: '99999997'
            };

            try {
                const response = await fetch('http://localhost:3000/api/ai/save-kyotaku-report', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(testData)
                });

                const result = await response.json();

                if (response.ok && result.success) {
                    resultDiv.innerHTML = `
                        <h3 class="success">âœ… ãƒ†ã‚¹ãƒˆæˆåŠŸ</h3>
                        <p><strong>ãƒ•ã‚¡ã‚¤ãƒ«ID:</strong> ${result.data.fileId}</p>
                        <p><strong>ãƒ•ã‚¡ã‚¤ãƒ«å:</strong> ${result.data.fileName}</p>
                        <p><strong>ä¿å­˜å…ˆ:</strong> ${result.data.filePath}</p>
                        <p><strong>ä½œæˆæ—¥æ™‚:</strong> ${new Date(result.data.createdAt).toLocaleString('ja-JP')}</p>
                    `;
                } else {
                    throw new Error(result.error || 'APIå‘¼ã³å‡ºã—ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <h3 class="error">âŒ ãƒ†ã‚¹ãƒˆå¤±æ•—</h3>
                    <p>${error.message}</p>
                `;
            }
        }
    </script>
</body>
</html>