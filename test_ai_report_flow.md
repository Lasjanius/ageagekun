# AI報告書生成フロー テストケース

## 変更内容
- 3ステップから2ステップに削減
- ステップ3（追加情報確認・編集）を削除
- ステップ2でAI生成ボタンを押すと直接報告書が生成される

## テスト手順

### 1. サーバー起動
```bash
cd backend
npm start
```
http://localhost:3000 でサーバーが起動していることを確認

### 2. AI報告書作成ページへアクセス
ブラウザで http://localhost:3000/ai_report.html を開く

### 3. ステップ1: 患者選択
- 患者リストが表示されることを確認
- 患者を1人選択（カードをクリック）
- 「次へ」ボタンが有効になることを確認
- 「次へ」ボタンをクリック

### 4. ステップ2: カルテ入力・報告書生成
- 選択した患者の情報が自動入力されていることを確認
- カルテ内容欄に以下のテストデータを入力：

```
2025/1/18 訪問診療
BP 132/78 P 72 BT 36.5
HbA1c 7.0% (前回7.5%)
血糖値 142mg/dl
膝痛(-)、歩行安定
処方継続：メトホルミン500mg 1T/1x朝
```

- 10文字以上入力すると「この内容でレポートをAI生成する」ボタンが有効になる
- AI生成ボタンをクリック

### 5. 処理の確認
- 「AI報告書を生成中...」のインジケーターが表示される
- 2-3秒後に「AI抽出が完了し、報告書を生成しています...」のトーストが表示される
- さらに「報告書の生成が完了しました！」のトーストが表示される
- 新しいタブで報告書が自動的に開く

### 6. 報告書の確認
新しいタブで開いた報告書に以下が含まれていることを確認：
- 患者情報（氏名、年齢、住所）
- ケアマネージャー情報
- AI抽出された情報：
  - 介護度
  - 主病名
  - 診察日
  - 次回診察日
- AI生成された診療内容
- AI選択された生活指導

## 期待される動作の変化

### 変更前（3ステップ）
1. 患者選択
2. カルテ入力 → AI生成ボタン
3. **AI抽出結果の確認・編集画面** → 報告書生成ボタン
4. 報告書表示

### 変更後（2ステップ）
1. 患者選択
2. カルテ入力 → AI生成ボタン → **直接報告書表示**

## エラー処理の確認

### OpenAI APIキー未設定の場合
- .env.localにOPENAI_API_KEYが設定されていない場合
- 「AI生成に失敗しました」のエラートーストが表示される
- 処理は中断されるが、アプリケーションは正常に動作を継続する

### カルテ内容が空の場合
- AI生成ボタンが無効のままになる
- クリックしても何も起きない

### 患者未選択の場合
- ステップ1で患者を選択しないと「次へ」ボタンが無効のまま
- ステップ2に進めない